<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Slim Lim">
  <meta name="author" content="Justin Lubin">
  <title>index</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #2a211c;
        color: #bdae9d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
    div.sourceCode
      { color: #58595c; background-color: #fdfdfd; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #c54516; font-weight: bold; } /* Alert */
    code span.an { color: #cc7e7e; font-style: italic; } /* Annotation */
    code span.at { } /* Attribute */
    code span.bn { color: #586dba; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #9d0909; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #586dba; } /* Char */
    code span.cn { } /* Constant */
    code span.co { color: #cc7e7e; font-style: italic; } /* Comment */
    code span.do { color: #cc7e7e; font-style: italic; } /* Documentation */
    code span.dt { color: #f20000; } /* DataType */
    code span.dv { color: #586dba; } /* DecVal */
    code span.er { color: #c54516; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #586dba; } /* Float */
    code span.fu { color: #f20000; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #cc7e7e; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #9d0909; font-weight: bold; } /* Keyword */
    code span.op { color: #a67f59; } /* Operator */
    code span.ot { color: #cc7e7e; } /* Other */
    code span.pp { font-weight: bold; } /* Preprocessor */
    code span.sc { color: #586dba; } /* SpecialChar */
    code span.ss { color: #586dba; } /* SpecialString */
    code span.st { color: #586dba; } /* String */
    code span.va { } /* Variable */
    code span.vs { color: #586dba; } /* VerbatimString */
    code span.wa { color: #c54516; font-weight: bold; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="slim.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title"><div style="font-size: 0.8em; margin-bottom: 0.5em;">
<img src='mime-jr.png' style='height: 1.5em; position: relative; top: 55px;'/><span style="font-weight: 400;">Mime Jr.</span><img src='https://www.serebii.net/pokedex-dp/evo/439.png' style='height: 1.5em; position: relative; top: 55px;'/>
</div>
Code formatting<br>by example</h1>
  <p class="author">Slim Lim</p>
  <p class="author">Justin Lubin</p>
</section>

<section>
<section id="matching-code-style-is-hard" class="title-slide slide level1">
<h1>Matching code style is hard</h1>

</section>
<section id="using-vs.-nested-parens" class="slide level2">
<h2>Using <code>$</code> vs. nested parens</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb1"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f (g (h x))</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb2"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">$</span> g (h x)</span></code></pre></div>
</div>
</div>
</section>
<section id="pattern-matching-vs.-case-expressions" class="slide level2">
<h2>Pattern matching vs. <code>case</code> expressions</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb3"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>f x (<span class="dt">Node</span> y l r) <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>f x (<span class="dt">Leaf</span> y) <span class="ot">=</span> <span class="op">...</span></span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb4"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>f x n <span class="ot">=</span> \<span class="kw">case</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Node</span> y l r <span class="ot">-&gt;</span> <span class="op">...</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Leaf</span> y <span class="ot">-&gt;</span> <span class="op">...</span></span></code></pre></div>
</div>
</div>
</section>
<section id="inline-expressions-vs.-let-binding" class="slide level2">
<h2>Inline expressions vs. <code>let</code>-binding</h2>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb5"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foldr</span> (\x y <span class="ot">-&gt;</span> x <span class="op">+</span> y) <span class="dv">0</span> xs</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb6"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x y <span class="ot">-&gt;</span> x <span class="op">+</span> y <span class="kw">in</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add <span class="dv">0</span> xs</span></code></pre></div>
</div>
</div>
</section>
<section id="knowing-when-to-rewrite-is-hard" class="slide level2">
<h2>Knowing <em>when</em> to rewrite is hard</h2>
<ul>
<li>Often depends on properties of the <strong>concrete syntax tree</strong> (CST)
<ul>
<li>e.g. line length, expression size, CST depth</li>
</ul></li>
<li>Even for simple properties, existing formatters require onerous configuration</li>
</ul>
<div class="fragment">
<blockquote>
<p>Can we use <strong>example code</strong> to produce rules for applying rewrites?</p>
</blockquote>
</div>
</section></section>
<section>
<section id="applying-transformations-by-example" class="title-slide slide level1">
<h1>Applying transformations <em>by example</em></h1>

</section>
<section id="goal" class="slide level2">
<h2>Goal</h2>
<p>Provide a framework for defining transformations based on CST properties</p>
<ul>
<li><strong>Given:</strong> a program transformation <span class="math inline">T</span> and input program <span class="math inline">P</span></li>
<li><strong>Synthesize:</strong> a guard <span class="math inline">g</span> to determine when to apply <span class="math inline">T</span> in a new <span class="math inline">P&#39;</span></li>
</ul>
</section>
<section id="example-let-hoisting" class="slide level2">
<h2>Example: <code>let</code>-hoisting</h2>
<p>Opposite of inlining: <strong>hoist</strong> an expression into a definition to improve readability of the final expression</p>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb7"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">foldr</span> (\x y <span class="ot">-&gt;</span> x <span class="op">+</span> y) <span class="dv">0</span> xs</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb8"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x y <span class="ot">-&gt;</span> x <span class="op">+</span> y <span class="kw">in</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add <span class="dv">0</span> xs</span></code></pre></div>
</div>
</div>
</section>
<section id="defining-transformations" class="slide level2">
<h2>Defining transformations</h2>
<p>A transformation <span class="math inline">T</span> rewrites a concrete syntax tree <span class="math inline">C</span>.</p>
<ul>
<li><strong>Matchers</strong> <span class="math inline">C \to \mathbf{2}</span> extract relevant pieces of syntax within a program
<ul>
<li>“Get all function arguments”</li>
<li>“Get all <code>let</code> bindings”</li>
</ul></li>
<li><strong>Transformer</strong> <span class="math inline">C \to C</span> rewrites a program, using the matcher(s) to extract sub-expressions <span class="math display">
  P \mapsto \texttt{let $v = x$ in $P[v/x]$}
  </span></li>
</ul>
</section></section>
<section>
<section id="synthesizing-guards" class="title-slide slide level1">
<h1>Synthesizing guards</h1>
<aside class="notes">
<p>So next we’ll talk about how we use matchers to decide where to apply transformers.</p>
</aside>
</section>
<section id="synthesizing-a-guard" class="slide level2">
<h2>Synthesizing a guard</h2>
<p>Given an input program <span class="math inline">P</span>, synthesize Boolean guard <span class="math inline">g</span> to determine where to apply <span class="math inline">T</span>.</p>
<p><span class="math display">\textsf{width} &gt; 20 \lor \textsf{depth}^* &gt; 4</span></p>
<p>* not implemented yet</p>
<aside class="notes">
<p>At a high level, our synthesis problem looks like this: we have some transformation <span class="math inline">T</span>. Now given an input program <span class="math inline">P</span>, we want to synthesize a Boolean guard called <span class="math inline">g</span> that tells us where <span class="math inline">g</span> should be applied.</p>
<p>Here’s an example of a guard we might synthesize: width &gt; 20 or depth &gt; 4, which says to apply the transformation anywhere the expression is more than 20 characters wide, or nested more than 4 levels deep.</p>
</aside>
</section>
<section id="guard-language" class="slide level2">
<h2>Guard language</h2>
<p><span class="math display">
\begin{aligned}
  n &amp;::= \mathbb{N} \mid \mathrm{width} \mid \ldots \\
  b &amp;::= \top \mid \bot \mid n &gt; n \mid n = n \mid b \land b \mid b \lor b \mid \lnot b
\end{aligned}
</span></p>
<div class="fragment">
<p><span class="math display">\textsf{width} &gt; 20 \lor \textsf{depth} &gt; 4</span></p>
<aside class="notes">
<p>We’ll use a DSL to describe guards. There are two components: numerical-valued guards, which denote natural numbers, and Boolean-valued guards, which denote Booleans.</p>
<p>We have all of the usual Boolean constructs like True, False, And, Or, and Not. In addition, we have constant natural numbers and an operator called <code>width</code>, which describes the width of a an expression’s concrete syntax in characters.</p>
</aside>
</div>
</section>
<section id="extracting-examples" class="slide level2">
<h2>Extracting examples</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> myList <span class="ot">=</span> <span class="st">&quot;abcdefghijklmnopqr&quot;</span> <span class="kw">in</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x, y <span class="ot">-&gt;</span> plus x</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                        y <span class="kw">in</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>          myList</span></code></pre></div>
<p>Each program admits a set of pairs <code>(argument, isBound)</code></p>
<aside class="notes">
<p>Now let’s take a look at how to extract input-output examples for our synthesis problem. Consider the following program, which defines two variables: a string called <code>myList</code>, and a lambda called <code>add</code>.</p>
<p>In addition, we have a function application of <code>foldr</code> to three arguments: - <code>add</code>, which is defined above, - the constant value <code>0</code> - and the string <code>myList</code>, also defined above.</p>
<p>We can think of each argument as an input, with an output Boolean corresponding to whether or not the argument is defined elsewhere.</p>
</aside>
</section>
<section id="extracting-examples-1" class="slide level2">
<h2>Extracting examples</h2>
<div class="columns">
<div class="column" style="width:45%;">
<div class="sourceCode" id="cb10"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> myList <span class="ot">=</span> <span class="st">&quot;abcdefghijklmnopqr&quot;</span> <span class="kw">in</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x, y <span class="ot">-&gt;</span> plus x</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                        y <span class="kw">in</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>          myList</span></code></pre></div>
</div><div class="column" style="width: 55%; font-size: 0.8em">
<table style="width:72%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 34%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th>Arg</th>
<th></th>
<th>Expression</th>
<th>Width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>add</code></td>
<td>✅</td>
<td><div class="sourceCode" id="cb11"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>\x, y <span class="ot">-&gt;</span> plus x</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>              y</span></code></pre></div></td>
<td>15</td>
</tr>
<tr class="even">
<td><code>0</code></td>
<td>❌</td>
<td><code>0</code></td>
<td>1</td>
</tr>
<tr class="odd">
<td><code>myList</code></td>
<td>✅</td>
<td><code>"abcdefghijklmnopqr"</code></td>
<td>20</td>
</tr>
<tr class="even">
<td><code>x</code></td>
<td>❌</td>
<td><code>x</code></td>
<td>1</td>
</tr>
<tr class="odd">
<td><code>y</code></td>
<td>❌</td>
<td><code>y</code></td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<aside class="notes">
<p>Here is a table summarizing each argument, whether or not it is <code>let</code>-bound, the corresponding expression, and the width of that expression. Note that for inline arguments we just take the width of the argument itself, but for bound arguments we take the width of the bound value.</p>
<p>These arguments form the input-output pairs for our synthesis problem.</p>
</aside>
</section>
<section id="denotational-semantics-for-guards" class="slide level2">
<h2>Denotational semantics for guards</h2>
<div class="columns" style="font-size: 0.8em;">
<div class="column" style="width:55%;">
<blockquote>
<p><span class="math inline">\llbracket \cdot \rrbracket_\mathbf{2} \, : \mathrm{CST} \to \mathbf{2}</span></p>
</blockquote>
<p><span class="math display">
\newcommand\nden[2]{\llbracket #1 \rrbracket_\mathbb{N} \, #2}
\newcommand\bden[2]{\llbracket #1 \rrbracket_\mathbf{2} \, #2}
\begin{aligned}
\bden{\top} \, e &amp;:= \top \\
\bden{\bot} \, e &amp;:= \bot \\
\bden{\lnot b}{e} &amp;:= \lnot \bden{b}\,e \\
\bden{n_1 &gt; n_2} e &amp;:= \nden{n_1}\,e &gt; \nden{n_2} \, e \\
\bden{n_1 = n_2}{e} &amp;:= \nden{n_1}\,e = \nden{n_2} \, e \\
\bden{b_1 \land b_2}{e} &amp;:= \bden{b_1}\,e \land \bden{b_2}\,e \\
\bden{b_1 \lor b_2}{e} &amp;:= \bden{b_1}\,e \lor \bden{b_2}\,e \\
\end{aligned}
</span></p>
</div><div class="column" style="width:45%;">

</div>
</div>
<aside class="notes">
<p>In order to formalize the notion of “width”, let’s take a step back and provide the denotational semantics for our guard DSL.</p>
<p>The denotation of Booleans, denoted with the subscript 2, is a function from concrete syntax trees to Boolean values.</p>
<p>We use the standard rules for Boolean algebra, lifting each operator into the meta-language.</p>
</aside>
</section>
<section id="denotational-semantics-for-guards-1" class="slide level2">
<h2>Denotational semantics for guards</h2>
<div class="columns" style="font-size: 0.8em;">
<div class="column" style="width:55%;">
<blockquote>
<p><span class="math inline">\llbracket \cdot \rrbracket_\mathbf{2} \, : \mathrm{CST} \to \mathbf{2}</span></p>
</blockquote>
<p><span class="math display">
\newcommand\nden[2]{\llbracket #1 \rrbracket_\mathbb{N} \, #2}
\newcommand\bden[2]{\llbracket #1 \rrbracket_\mathbf{2} \, #2}
\begin{aligned}
\bden{\top} \, e &amp;:= \top \\
\bden{\bot} \, e &amp;:= \bot \\
\bden{\lnot b}{e} &amp;:= \lnot \bden{b}\,e \\
\bden{n_1 &gt; n_2} e &amp;:= \nden{n_1}\,e &gt; \nden{n_2} \, e \\
\bden{n_1 = n_2}{e} &amp;:= \nden{n_1}\,e = \nden{n_2} \, e \\
\bden{b_1 \land b_2}{e} &amp;:= \bden{b_1}\,e \land \bden{b_2}\,e \\
\bden{b_1 \lor b_2}{e} &amp;:= \bden{b_1}\,e \lor \bden{b_2}\,e \\
\end{aligned}
</span></p>
</div><div class="column" style="width:45%;">
<blockquote>
<p><span class="math inline">\llbracket \cdot \rrbracket_\mathbb{N} \, : \mathrm{CST} \to \mathbb{N}</span></p>
</blockquote>
<p><span class="math display">
\newcommand\nden[2]{\llbracket #1 \rrbracket_\mathbb{N} \, #2}
\begin{aligned}
\nden{c}&amp; e = c \in \mathbb{N} \\
\nden{\mathrm{width}}&amp; {e} = \max \left( {\textsf{len}(e_i)} \right ),
 \; \forall e_i \in e \\
\nden{\mathrm{depth}}&amp;{e} = \textsf{depth}(e) \\
\end{aligned}
</span></p>
</div>
</div>
<aside class="notes">
<p>For naturals, the denotation is a function from concrete syntax trees to natural numbers.</p>
<p>Numeric literals denote the corresponding literal value, while operators like <code>width</code> and <code>depth</code> denote properties of the given expression’s concrete syntax tree.</p>
<p>Let’s take a look at what that means.</p>
</aside>
</section>
<section class="slide level2">

<h3 id="newcommandnden2llbracket-1-rrbracket_mathbbn-2-ndenmathrmwidth-e-max-left-textsflene_i-right-forall-e_i-in-e"><span class="math inline">\newcommand\nden[2]{\llbracket #1 \rrbracket_\mathbb{N} \, #2} \nden{\mathrm{width}} {e} = \max \left( {\textsf{len}(e_i)} \right ),  \; \forall e_i \in e</span></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> myList <span class="ot">=</span> <span class="st">&quot;abcdefghijklmnopqr&quot;</span> <span class="kw">in</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">--        vvvvvvvvvvvvvvv</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x, y <span class="ot">-&gt;</span> plus x</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                        y <span class="kw">in</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">--        ^^^^^^^^^^^^^^^ </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">--        15 characters wide</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>          myList</span></code></pre></div>
<aside class="notes">
<p>Here we have the expression <code>add</code>, which spans multiple lines.</p>
<p>To take its width, we look at the length of the longest line, starting from the leftmost position of the first line. <code>width</code> is 15 characters long in its longest line, so the denotation of <code>width</code> on <code>add</code> is 15.</p>
</aside>
</section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ol type="1">
<li>Extract input-output examples</li>
<li>Define grammar for guards</li>
<li><strong>Synthesize guards</strong></li>
</ol>
</section>
<section id="synthesizing-guards-1" class="slide level2">
<h2>Synthesizing guards</h2>
<p>Using <strong>bottom-up enumerative synthesis</strong> (<a href="https://people.csail.mit.edu/asolar/SynthesisCourse/Lecture3.htm">Armando Solar-Lezama</a>)</p>
<div class="columns" style="font-size: 0.8em;">
<div class="column">
<div class="sourceCode" id="cb13"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> <span class="dt">Let</span> (<span class="dt">Name</span> <span class="st">&quot;myList&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>           (<span class="dt">Lit</span> (<span class="dt">LStr</span> <span class="st">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>)) <span class="op">$</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="dt">Let</span> (<span class="dt">Name</span> <span class="st">&quot;add&quot;</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           (<span class="dt">Lam</span> [<span class="dt">Name</span> <span class="st">&quot;x&quot;</span>, <span class="dt">Name</span> <span class="st">&quot;y&quot;</span>] <span class="op">$</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                <span class="dt">App</span> (<span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;plus&quot;</span>)) </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                    [<span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;x&quot;</span>), <span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;y&quot;</span>)]) <span class="op">$</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>           <span class="dt">App</span> (<span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;foldr&quot;</span>)) </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>               [ <span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;add&quot;</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>               , <span class="dt">Lit</span> (<span class="dt">LNum</span> <span class="dv">0</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>               , <span class="dt">Var</span> (<span class="dt">Name</span> <span class="st">&quot;myList&quot;</span>) ]</span></code></pre></div>
</div><div class="column">
<div class="sourceCode" id="cb14"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> synth (getExamples test) <span class="dv">3</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> res <span class="kw">of</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Just</span> x <span class="ot">-&gt;</span> <span class="fu">print</span> x</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      _ <span class="ot">-&gt;</span> <span class="fu">print</span> <span class="st">&quot;No solution found&quot;</span></span></code></pre></div>
</div>
</div>
<aside class="notes">
<p>The final step is to synthesize a guard.</p>
<p>On the left we have an input program corresponding to the example we’ve been studying, and on the right we have some code to extract examples and synthesize a guard.</p>
</aside>
</section>
<section id="synthesizing-guards-2" class="slide level2">
<h2>Synthesizing guards</h2>
<div class="sourceCode" id="cb15" style="font-size: 0.8em;"><pre class="sourceCode hs"><code class="sourceCode haskell"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="op">********</span> <span class="dt">Synthesizing</span> guards for program<span class="op">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> myList <span class="ot">=</span> <span class="st">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span> <span class="kw">in</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> add <span class="ot">=</span> \x, y <span class="ot">-&gt;</span> plus x</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                        y <span class="kw">in</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">foldr</span> add</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>          myList</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">********</span> <span class="dt">Extracting</span> examples<span class="op">:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>[(<span class="dt">True</span>,<span class="dv">15</span>),(<span class="dt">False</span>,<span class="dv">1</span>),(<span class="dt">True</span>,<span class="dv">28</span>),(<span class="dt">False</span>,<span class="dv">1</span>),(<span class="dt">False</span>,<span class="dv">1</span>)]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="op">********</span> <span class="dt">Synthesized</span> guard<span class="op">:</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>width <span class="op">&gt;</span> <span class="dv">10</span></span></code></pre></div>
<aside class="notes">
<p>If we run this code, we get the following output. First you can see the formatted program, followed by the input-output examples, and finally the synthesized guard.</p>
<p>Indeed, we can see that values with width greater than 10 are <code>let</code>-bound, while values with smaller widths are left inline.</p>
<p>We can use this guard when applying the transformation to a new program, hoisting any inline argument wider than 10 characters.</p>
</aside>
<p>* real output</p>
</section></section>
<section id="future-work" class="title-slide slide level1">
<h1>Future work</h1>
<ul>
<li>Implement other transformations
<ul>
<li>Using <code>$</code> vs. nested parens</li>
<li>Pattern-matching vs. <code>case</code> expressions</li>
</ul></li>
<li>Extend guard language to include more constructs
<ul>
<li><span class="math inline">\textsf{depth}</span>: nesting depth of an expression</li>
<li><span class="math inline">\textsf{area}</span>: takes the area of an expression, in characters</li>
</ul></li>
<li>Prove that rewrites are semantics-preserving
<ul>
<li>Would be onerous for authors of a transformation</li>
</ul></li>
</ul>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1250,

        height: 850,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
